syntax = "proto3";

package chat.v1;

import "rbt/v1alpha1/options.proto";

////////////////////////////////////////////////////////////////////////

service UsersMethods {
  rpc Add(AddRequest) returns (AddResponse) {
    option (rbt.v1alpha1.method) = {
      writer: {},
    };
  }

  rpc List(ListRequest) returns (ListResponse) {
    option (rbt.v1alpha1.method) = {
      reader: {},
    };
  }
}

////////////////////////////////////////////////////////////////////////

message Users {
  option (rbt.v1alpha1.state) = {
  };
  repeated string users = 1;
}

message AddRequest {
  string user = 1;
}

message AddResponse {
}
message ListRequest {}

message ListResponse {
  repeated string users = 1;
}
////////////////////////////////////////////////////////////////////////

service UserMethods {
  rpc Create(CreateRequest) returns (CreateResponse) {
    option (rbt.v1alpha1.method) = {
      transaction: {},
    };
  }

  rpc MessagesReactions(MessagesReactionsRequest)
      returns (MessagesReactionsResponse) {
    option (rbt.v1alpha1.method) = {
      reader: {},
    };
  }
}

////////////////////////////////////////////////////////////////////////

message User {
  option (rbt.v1alpha1.state) = {
  };
}

////////////////////////////////////////////////////////////////////////

message CreateRequest {}
message CreateResponse {}

////////////////////////////////////////////////////////////////////////

message MessageReaction {
  // ID of message that we reacted to.
  string message_id = 1;

  // Unicode that captures the reaction.
  string unicode = 2;

  // User that made the reaction.
  string user = 3;

  // Snippet of text we computed for displaying this reaction.
  string snippet = 4;
}

////////////////////////////////////////////////////////////////////////

message MessagesReactionsRequest {
  uint32 limit = 1;
}

message MessagesReactionsResponse {
  // Map from reaction ID (UUIDv7) to `MessageReaction`.
  map<string, MessageReaction> reactions = 1;
}

////////////////////////////////////////////////////////////////////////
